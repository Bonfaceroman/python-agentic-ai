response = openai.ChatCompletion.create(
    model="llama-3.3-70b-versatile",
    messages=[
        {"role": "system", "content": prompt_config["system"]},
        {"role": "user", "content": prompt_config["user"]}
    ],
    temperature=prompt_config["temp"],
    max_tokens=2000
)



# Universal content generator
def generate_content(content_type, user_description):
    prompts = {
        "blog": {
            "system": "You are an expert blog writer who creates engaging, readable content. Write conversationally, use clear structure with headings, keep paragraphs short.",
            "user": f"Write a blog post: {user_description}",
            "temp": 0.8
        },
        "twitter": {
            "system": "You are a Twitter/X expert. Create 5 engaging tweets (max 280 chars each). Use 2-3 hashtags. Number them clearly.",
            "user": f"Create Twitter posts: {user_description}",
            "temp": 0.9
        },
        "linkedin": {
            "system": "You are a LinkedIn strategist. Create 3-5 professional posts. Share insights, use 1-2 hashtags. Number them clearly.",
            "user": f"Create LinkedIn posts: {user_description}",
            "temp": 0.8
        },
        "instagram": {
            "system": "You are an Instagram creator. Create 3-5 captions with 5-8 hashtags. First line must hook readers. Number them clearly.",
            "user": f"Create Instagram captions: {user_description}",
            "temp": 0.9
        },
        "facebook": {
            "system": "You are a Facebook content specialist. Create 3-5 engaging posts. Conversational tone, ask questions. Number them clearly.",
            "user": f"Create Facebook posts: {user_description}",
            "temp": 0.85
        },
        "email": {
            "system": "You are a professional email writer. Format: Subject, Greeting, Body, Closing, Sign off. Keep under 250 words, professional but warm.",
            "user": f"Write an email: {user_description}",
            "temp": 0.6
        },
        "product": {
            "system": "You are a conversion copywriter. Focus on benefits, not features. 150-200 words, address pain points, create desire, strong CTA.",
            "user": f"Write product description: {user_description}",
            "temp": 0.8
        }
    }

    prompt_config = prompts.get(content_type, prompts["blog"])

    response = openai.ChatCompletion.create(
        model="llama-3.3-70b-versatile",
        messages=[
            {"role": "system", "content": prompt_config["system"]},
            {"role": "user", "content": prompt_config["user"]}
        ],
        temperature=prompt_config["temp"],
        max_tokens=2000
    )

    return response.choices[0].message.content

# ROUTES
@app.route('/')
def home():
    return render_template('index.html')

@app.route('/generate', methods=['POST'])
def generate():
    try:
        data = request.json
        content_type = data.get('content_type')
        description = data.get('description')

        if not content_type or not description:
            return jsonify({'error': 'Missing content_type or description'}), 400

        content = generate_content(content_type, description)

        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        filename = f"{content_type}_{timestamp}.txt"

        if not os.path.exists('generated_content'):
            os.makedirs('generated_content')

        filepath = f"generated_content/{filename}"
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)

        return jsonify({
            'success': True,
            'content': content,
            'filename': filename
        })

    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/download/<filename>')
def download(filename):
    filepath = f"generated_content/{filename}"
    if os.path.exists(filepath):
        return send_file(filepath, as_attachment=True)
    return jsonify({'error': 'File not found'}), 404

if __name__ == '__main__':
    print("\n" + "="*70)
    print("ðŸš€ AI CONTENT GENERATOR - PREMIUM SAAS")
    print("="*70)
    print("\nâœ… Server starting...")
    print("ðŸ“± Open your browser and go to: http://localhost:5000")
    print("\nðŸ’¡ Press Ctrl+C to stop the server")
    print("="*70 + "\n")

    app.run(debug=False, host='0.0.0.0', port=5000)

